<!DOCTYPE html>
<html>

<head>
	<link rel="stylesheet" type="text/css" href="cindy.bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="mystyle.css">


	<script src="jquery.js" ></script>
	<script src="bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-sheetrock/1.0.1/dist/sheetrock.min.js"></script>
	<script src="https://code.highcharts.com/maps/highmaps.js"></script>
	<script src="https://code.highcharts.com/maps/modules/data.js"></script>
	<script src="https://code.highcharts.com/mapdata/countries/us/us-all.js"></script>
	<script src="https://code.highcharts.com/maps/modules/drilldown.js"></script>
	<link href="https://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
	<script src="http://code.highcharts.com/mapdata/countries/us/us-tx-all.js"></script>

</head>

<!--<style="padding: 50px">-->
<div class="text-center">
    <div class="row">
        <nav class="navbar">
            <div class="container-fluid">
                <ul class="nav navbar-nav">
										<li><a href="maplanding.html" class="ND">Home</a></li>
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown">Background
                            <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#">Page 1-1</a></li>
                            <li><a href="#">Page 1-2</a></li>
                        </ul>
                    </li>
										<!--
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown">News
                            <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#">Page 2-1</a></li>
                            <li><a href="#">Page 2-2</a></li>
                            <li><a href="#">Page 3-3</a></li>
                        </ul>
                    </li>-->
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown">Organizations
                            <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="https://www.brennancenter.org/issues/voting-rights-elections">Brennan Center for Justice</a></li>
                            <li><a href="https://www.aclu.org/issues/voting-rights">ACLU</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown">Tools
                            <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="filtering.html">State Filtering Tool</a></li>
                            <!--<li><a href="#">Page 4-2</a></li>
                            <li><a href="#">Page 4-3</a></li>-->
                        </ul>
                    </li>
										<!--
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown">Get Involved
                            <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="http://www.w3schools.com/html/">Page 5-1</a></li>
                            <li><a href="#">Page 5-2</a></li>
                            <li><a href="#">Page 5-3</a></li>
                            <li><a href="#">Page 5-4</a></li>
                        </ul>
                    </li>-->
                    <li><a href="#" class="ND">About</a></li>
                </ul>
            </div>
        </nav>

    </div>
</div>

<div class="row" style="padding: 50px">
	<div style="float: left; width: 40%">
		<!--<div class="col-md-4">-->
		
		<div>
			<h4> Select different criteria to see which states satisfy them. <h4>
		</div>
		<br/>
		<div>
			<h4>Voter ID Requirements</h4>
		</div>

		<div class="checkbox">
			<label><input type="checkbox" value="NDR" name="voteID">No document required (NDR)</label>
		</div>
		<div class="checkbox">
			<label><input type="checkbox" value="IRPNR" name="voteID">ID requested; photo not required (IRPNR)</label>
		</div>
		<div class="checkbox">
			<label><input type="checkbox" value="PIR" name="voteID">Photo ID requested (PIR)</label>
		</div>
		<div class="checkbox">
			<label><input type="checkbox" value="SNP" name="voteID">Strict Non-Photo ID (SNP)</label>
		</div>
		<div class="checkbox">
			<label><input type="checkbox" value="SP" name="voteID">Strict Photo ID (SP)</label>
		</div>

		<hr>

		<div>
			<h4>Early Voting (EV) & Absentee Voting (AV) </h4>
		</div>

		<div class="checkbox">
			<label><input type="checkbox" value="NER" name="early">NO EV and reason required for AV (NER)</label>
		</div>
		<div class="checkbox">
			<label><input type="checkbox" value="ER" name="early">EV and reason required for AV (ER)</label>
		</div>
		<div class="checkbox">
			<label><input type="checkbox" value="ENR" name="early">EV and NO reason required for AV (ENR)</label>
		</div>

		<div class="checkbox">
			<label><input type="checkbox" value="AMV" name="early"> All-mail voting (AMV)</label>
		</div>

		<hr>

		<div>
			<h4>Party Control of State Legislature (PCSL)</h4>
		</div>

		<div class="checkbox">
			<label><input type="checkbox" value="Republican" name="state">Republican</label>
		</div>
		<div class="checkbox">
			<label><input type="checkbox" value="Democrat" name="state">Democrat</label>
		</div>
		<div class="checkbox">
			<label><input type="checkbox" value="Split" name="state">Split</label>
		</div>
		<div class="checkbox">
			<label><input type="checkbox" value="Non-partisan" name="state">Non-partisan</label>
		</div>

		<hr>

		<div>
			<h4>Same Day Voting Registration</h4>
		</div>

		<div>
			<label class="checkbox-inline"><input type="checkbox" value="Yes" name="same">Yes</label>
			<label class="checkbox-inline"><input type="checkbox" value="No" name="same">No</label>
		</div>

		<hr>

		<div>
			<h4>Swing State</h4>
		</div>

		<div>
			<label class="checkbox-inline"><input type="checkbox" value="Yes" name="swing">Yes</label>
			<label class="checkbox-inline"><input type="checkbox" value="No" name="swing">No</label>
		</div>

		<div>
		</div>

		<div class="text-center">
			<!--<button id="apply" type="button" class="btn btn-primary">Apply Filters</button>-->
			<button id="clear" type="button" class="btn btn-secondary">Clear Filters</button>
		</div>



	</div>

	<div style="float: left; width: 60%" id='tableSection' style="padding-top: 30pt;">
		<!--<div class="col-md-8" id='tableSection' style="padding-top: 30pt;">-->
		<table id="statistics" class="table table-condensed table-striped" hidden></table>
		<div id="container" style="height: 700px; min-width: 310px; max-width: 800px; margin: 0 auto">
		</div>
	</div>
	<div class="col-md-8">

		<script>
			$( document ).ready(function(){

				var mySpreadsheet = 'https://docs.google.com/spreadsheets/d/1U9Yj8hcrI8AFKB46iS7eSN_MAuwhQaLaPQCFWRGqlU0/edit#gid=0';
				//var mySpreadsheet = 'https://docs.google.com/spreadsheets/d/1qT1LyvoAcb0HTsi2rHBltBVpUBumAUzT__rhMvrz5Rk/edit#gid=0';

				// Load an entire worksheet.

				var requests = {}
				var queryString = "init";
				var stateData;
				var title = "All States (No Filtering)";

				var myCallback = function (error, options, response) {
					if (!error) {
						//Will need to investigate further.
						requests[queryString] = [];
						
						if(queryString === "init"){
							requests["init"] = [] 
						}else{
							for (var i = 0; i < response.rows.length; i++) {
								requests[queryString].push(response.rows[i].cellsArray[0]);
							}
						}
					}else{
						console.log("NO!");
						console.log(error);
						console.log(response);
						requests[queryString] = [];
					}

					stateData = requests[queryString]
					console.log(stateData);
					createMap(stateData, title);
				};

				//Get the initial data
				$('#statistics').sheetrock({
					url: mySpreadsheet,
					query: 'select * where A <> "State"',
					callback: myCallback
				});



				/*$('input:checkbox').click(function(){
				 if($(this).prop('checked')){
				 console.log($(this).val());
				 }else{
				 console.log("SUCK IT!");
				 }
				 }); */


				//$('#apply').click(function(){
				$('input:checkbox').click(function(){
					$("#statistics").remove();

					$('#tableSection').append('<table id="statistics" class="table table-condensed table-striped" hidden></table>');

					var voteIDArr = [];
					var earlyArr = [];
					var stateArr = [];
					var sameArr = [];
					var swingArr = [];

					$("input:checkbox[name='voteID']:checked").each(function(){
						voteIDArr.push($(this).val());
					});
					$("input:checkbox[name='early']:checked").each(function(){
						earlyArr.push($(this).val());
					});
					$("input:checkbox[name='state']:checked").each(function(){
						stateArr.push($(this).val());
					});
					$("input:checkbox[name='same']:checked").each(function(){
						sameArr.push($(this).val());
					});
					$("input:checkbox[name='swing']:checked").each(function(){
						swingArr.push($(this).val());
					});

					console.log(voteIDArr);
					console.log(earlyArr);
					console.log(stateArr);
					console.log(sameArr);
					console.log(swingArr);

					if(voteIDArr.length == 0 && earlyArr == 0 && stateArr.length == 0 &&
							sameArr.length == 0 && swingArr.length == 0){
						title = "All States (No Filtering)";
						createMap(requests["init"], title);

					}else{

						queryString = "select * where";
						title = "States where";

						var before = false;

						if(voteIDArr.length > 0 && before){
							queryString = queryString + " and (";
							title = title + " and \'ID req\' = (";
						}else if(voteIDArr.length > 0){
							queryString = queryString + " (";
							title = title + " \'ID req\' = (";
						}

						if(voteIDArr.length > 0){
							before = true;

							for(i = 0; i < voteIDArr.length; i++){
								if(i == 0){
									queryString = queryString + "C = \'" + voteIDArr[i] + "\'";
									title = title + voteIDArr[i];
								}else{
									queryString = queryString + " or C = \'" + voteIDArr[i] + "\'";
									title = title + " or " + voteIDArr[i];
								}
							}
						}

						if(voteIDArr.length > 0){
							queryString = queryString + ")";
							title = title + ")";
						}

						if(earlyArr.length > 0 && before){
							queryString = queryString + " and (";
							title = title + " and \'EV & AV\' = (";
						}else if(earlyArr.length > 0){
							queryString = queryString + " (";
							title = title + " \'EV & AV\' = (";
						}

						if(earlyArr.length > 0){

							before = true;

							for(i = 0; i < earlyArr.length; i++){
								if(i == 0){
									queryString = queryString + "D = \'" + earlyArr[i] + "\'";
									title = title + earlyArr[i];
								}else{
									queryString = queryString + " or D = \'" + earlyArr[i] + "\'";
									title = title + " or " + earlyArr[i];
								}
							}
						}

						if(earlyArr.length > 0){
							queryString = queryString + ")";
							title = title + ")";
						}

						if(stateArr.length > 0 && before){
							queryString = queryString + " and (";
							title = title + " and \'PCSL\' = (";
						}else if(stateArr.length > 0){
							queryString = queryString + " (";
							title = title + " \'PCSL\' = (";
						}

						if(stateArr.length > 0){

							before = true;

							for(i = 0; i < stateArr.length; i++){
								if(i == 0){
									queryString = queryString + "E = \'" + stateArr[i] + "\'";
									title = title + stateArr[i];
								}else{
									queryString = queryString + " or E = \'" + stateArr[i] + "\'";
									title = title + " or " + stateArr[i];
								}
							}
						}

						if(stateArr.length > 0){
							queryString = queryString + ")";
							title = title + ")";
						}

						if(sameArr.length > 0 && before){
							queryString = queryString + " and (";
							title = title + " and \'Same Day\' = (";
						}else if(sameArr.length > 0){
							queryString = queryString + " (";
							title = title + " \'Same Day\' = (";
						}

						if(sameArr.length > 0){

							before = true;

							for(i = 0; i < sameArr.length; i++){
								if(i == 0){
									queryString = queryString + "F = \'" + sameArr[i] + "\'";
									title = title + sameArr[i];
								}else{
									queryString = queryString + " or F = \'" + sameArr[i] + "\'";
									title = title + " or " + sameArr[i];
								}
							}
						}

						if(sameArr.length > 0){
							queryString = queryString + ")";
							title = title + ")";
						}

						if(swingArr.length > 0 && before){
							queryString = queryString + " and (";
							title = title + " and \'Swing State\' = (";
						}else if(swingArr.length > 0){
							queryString = queryString + " (";
							title = title + " \'Swing State\' = (";
						}

						if(swingArr.length > 0){

							before = true;

							for(i = 0; i < swingArr.length; i++){
								if(i == 0){
									queryString = queryString + "G = \'" + swingArr[i] + "\'";
									title = title + swingArr[i];
								}else{
									queryString = queryString + " or G = \'" + swingArr[i] + "\'";
									title = title + " or " + swingArr[i];
								}
							}
						}

						if(swingArr.length > 0){
							queryString = queryString + ")";
							title = title + ")";
						}

						//queryString = queryString +" or A = 'State'";

						console.log(queryString);

						if(queryString in requests){
							createMap(requests[queryString], title);
						}else{
							$('#statistics').sheetrock({
								url: mySpreadsheet,
								query: queryString,
								callback: myCallback
							});
						}


					}
				});

				$('#clear').click(function(){
					$("#statistics").remove();
					$('#tableSection').append('<table id="statistics" class="table table-condensed table-striped" hidden></table>');

					$('input:checkbox').prop('checked', false);
					title = "All States (No Filtering)";
					createMap(requests["init"], title);

				});

				function createMap(filteredStates, title) {

					var data = Highcharts.geojson(Highcharts.maps['countries/us/us-all']),
					// Some responsiveness
							small = $('#container').width() < 400;

					//console.log("YAS");
					console.log(filteredStates);
					//filteredStates.splice(1, 1);
					//filteredStates = ["Maryland", "Alaska"]
					//console.log(this.properties);
					$.each(data, function () {
						if(filteredStates.indexOf(this.name) == -1){
							this.value = 1;
						}else{
							//console.log(this.name);
							this.value = 2;
						}
					});

					// Instanciate the map
					$('#container').highcharts('Map', {


						/*title: {
							text: title,
							style: {
								color: '#F0F8FF'
							}
						},*/
						plotOptions: {
							map: {
								allAreas: false,
								joinBy: ['postal-code', 'code'],
								dataLabels: {
									enabled: true,
									color: '#FFFFFF',
									format: '{point.code}',
									style: {
										fontWeight: 'bold'
									}
								},
								mapData: Highcharts.maps['countries/us/us-all'],
								tooltip: {
									headerFormat: '',
									pointFormat: '{point.name}'
								}

							},
						},
						legend:{
							enabled: false
						},
						chart: {
							backgroundColor: '#272b30'
						},

						colorAxis: {
							min: 1,
							max: 2,
							minColor: '#A8A8A8',
							//maxColor: '#4b96af'
							maxColor: '#FFFFFF'
						},
						series: [{
							data: data,
							mapData: Highcharts.maps['countries/us/us-tx-all'],
							joinBy: 'hc-key',
							states: {
								hover: {
									color: '#fa1'
								}
							}
						}]
					});
				};
			});

		</script>
</body>
</html>